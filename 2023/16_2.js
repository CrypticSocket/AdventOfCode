/*
Learnings: 
Overcaching can be an issue, luckily that was my problem in the previous part XD
This was super easy because my foundation was prebuilt.
*/

let dummyInput = String.raw`.|...\....
|.-.\.....
.....|-...
........|.
..........
.........\
..../.\\..
.-.-/..|..
.|....-|.\
..//.|....`

let dummyInput2 = String.raw`.....|/\|...\
/...\..|-....
.-.\..../..\.
...-....\....
.\..-..\.../.
\....-....../`


let dummyInput3 = String.raw`
.....|......\
.............
.............
.............
.............
\....-....../`

let actualInput = String.raw`\.......-..|.....-.........\.|.\................................................-......................\.../..
...........|......\...\...-..-......................--.....|...........\....|./..........-../-......|....-.../
...|\...............................././............./......|....\/................/......../...........|...\.
........-............-......................|..|......................................|......................\
........../..................\............|......./............................-./....\.......................
.....-....-..\..|..|.-...\...\.........................../......-..--.......|..\......\...|.........|..../....
.........\.....|.....................................|.......|..........-.....................................
.......|..........|................................................-............-......../......|........./...
\.....-|............./........-.....\.....-......-....\...........-.........\..|............./................
.../......\...-...........-.......|...-......\-.........../......../..\..............-.............|..........
....|........................./..|.|......./....../.......-.......................\./.........................
.........\.......|/.........-...................\.......|..\...............|..../....-.....-..../.............
/..-........\..........................\-....|...\......\.............|../..-.....|...................../../..
............/|.......................|.............\...\.......\........../...........-./...................\.
.........../.-....\.\.....................\./............\...............................-.................\..
......\\.......-........-.|..........................-............-...........................................
............-....-.....|....\........|.............................../.........-|...|\..-...............|.....
............/...-....|....|......-..\..\.-............-./\.-.........|....//...............-.........-|.......
..............-............................-..................\\...\..\-..\................./.............\.\.
.../......|......../..../......../..\./..............|..../................/.........|...............././.....
.............\.|...|....-...-.........|.......\.....\.........\..-.......-...............\...\..\|..../.......
.......-..........\../..........................\......\../......\...-....|..../...|./..\............-.-......
.................\....-...................../.........-.......................-..............|................
..-\.............-..............-../.-../...../.......|..................|.......-................|.......\...
.......\|.-....\.../..................\......\....../..|-.........-.........|....\..................\........|
.....././...........\.-........-..-...\..........-\.............|.....|..-.........|...............|..........
..............-..|........./..\..|............-..........|......................./....................\-.\....
...................-..............................................-....-....|..............-.........|././.../
...\...........................|..\...................../..........-......./......./...............|..........
.......................-......../...-....../....../.....././.|.......\|......\..........-.../..-......./......
...\..............\../..|..-\........................../-....\........................../........./...|.|...-.
..........\...../...|.|.......\........./................\.......-.-.....|........|/..............\...........
..................\....\....|......\.......//.............../.|.\................../..........|..-............
.......\.\............./...............-....................../........................\./...................-
.........../....\...........|\./|...|................./...-........\.\.....\.....|......|....\...../..........
...........\.....|......|...........|............/............................................\/........../|..
..../......\\.................../.|.......|...--..\.-../\/.................|..................................
....................\....\..|................................\.........-...........-................|.........
.........................|...-......-.................\...............|\......./...--\........................
..../....|..|......\..\....................../|.....................\|............................-...|.......
\......./...../..............\......|...|.\....../.....|...................|...........\.......\.............\
...............|./..-..-|....\....-.................-................-.........../..\..-......................
..-.............................\.\-.................\...........-........|.......-..............-....../.....
........\.-.................../\..............-.|.................................\.|.........-..............|
...................................|..\.........|...-................./.......-.....-/.\..........\...\|......
./........-.......|......|../...-.\...........\.........|-............................-..-...\.....//......|..
..................-........\.../............................................./.....|......./....\........|....
..-|..........-......................|.\...............................\/........../.....|...............|....
...\......\.\.....|.........|...../.|../.............................|.....\./....../............./..\........
.......\..-.\...-//................-...........................-........\..../..................-.............
..../.................\..|..........\\.....-......................|-.................\.........|..............
..\.\...-..../........|..................................\...|-.././......\.\......./|......./-....-......-\..
-......................................-.......................\............\...............|.\.........\.....
../.-....../......................\..........................-..\......\.......|...\.-.....................|..
..-..-..\...............\-...............................\...............-........./......-.\............-....
.............--....\...-../........./-.......................\............................-...................
....-..............-\../-...........-......|\...............................|.........--........./......\../..
....-.\/.../.-.........|........./........-................\..............\.../........|............|.....--..
........\-...\...........|...\.......-\.....|-...........................................-|............\......
............./.-..........\....................\......\............\.../../.-...-.......-.....................
.......|\..........-....................|.|.../.-.|.\...\/....../...|..-./....................................
./.....\.-.../...\.......|.........../....................-.....................\|..\..|........|...\.........
.................|..........--..../..|............|..|.......-.....|.......-................\.................
.-.-.....|..|/..............................-...............-\....|..................\.|.....\.\...........|..
......................-\|-..\...|.............\................................../...\........\|..............
..........--\..\...........-...|........-......................\./..|.........................................
...........|.|.....|.....................|........./....-.......-.......|................\....................
....-..............\.....\....-........................\............--.............-.-...............//.......
\.......\..........|.\................................\......|.........-..|...................../.............
................\...\.....|...........-..|................\...........|.........|............|............../.
.................................-/........../....../..............|................../.../...\..../..........
.....\..\........|......|...................|............\..\................./....../............|.........|.
............................................|.........|...................|..\........-...........\...-/......
.......//-..........\........|......//................\..........-........|......\.......-.......\....-.......
-........\.......\.....--.........................-.............|..../.........../............/.......-..\.../
.....\|..../..-.\..-....|.-......|...................../..\...|/............/../.......\..............|..-.../
........-...........-.........|.....-.............................../.........-................../.\..-....\..
..................|......................|.\......\../....................../.-............././...........\...
.|....\.....\..........\.................\....\....................\....................\/......|............\
/...\..\......-...-...........................-.......\|....\............/..............................|.....
............|..\...../..-..|.........|..-..............-.....-\.........\.......-...................\...../..-
....../................./.........../..............-....|.......................\........................./...
....\..-......./............................................/.............|......./..-..\\........../..../....
.............................................|................./.......................|......|.............-.
........|......-................\.................|.|.-............/.......|...............|...........\......
............................................................|.../..............................\........|.....
....../....\.|.|\/|..............-....|......../.-....................-......|.-.......................\......
./......../....................../.../..............\..................\....\...-/............\...............
...-..../...\.|.....|.......|...........\......||..|.................................-.....................|..
/..-/........|.......................|..../-./................|................/.......|...-../...............
....../-..................|..|....-..|.......................|-......-..\...././..../-\....|......|..|........
...........-................\..........-..........................................-...........................
..|.................................|........................\...................|......\\....................
..../....../...-........//............-..................-..........................-...\................\....
......|...................|...../.............................-.................--.../...............|...|...\
....../...........\..|....-.|..|.............../-.................-.............|.....-..........\/......|....
......|.........../....\............./.........\......\...-.\.......|...-.....|./.....-........./.............
..\.|......../........-....|.-...................//|.........-...............|................................
...................................\............/..............-................/-......-........\.........-..
.-...-..|....|................|...|.........|.....//...../............\...............-.|.....................
../...............................\..............-..........-.................................................
...-..\....-...|/.............-......|/...-..|..-.........|...\..|../...|.....|.........................|...-.
....../.......\.......--.............../....\......................\...\..........................-...........
..-......-.......|....\|.../...-..-....|......\.|..............................-...............|...|..........
......-....../............-./.-.............\.-\/............../................................./............
..........--/..../..|...\.....\.....|.\...\.....................................\|......./............-|..-..\
..|......................../\........./.................\............-......-............/..........|....|.|..
.-|.....................-..-..\...............-...................|....../...........................\........
.................-.......\\.../........-.............\.......-......|\..........|....-..............\...../...
|.......|...\..................\../................|..\.................../..\......-..\.-................/...`

const directionValue = {
    'U' : [-1, 0],
    'D' : [1, 0],
    'L' : [0, -1],
    'R' : [0, 1]
}

const directionContraptionCombination = {
    'R/' : 'U',
    'L/' : 'D',
    'U/' : 'R',
    'D/' : 'L',
    'R\\' : 'D',
    'L\\' : 'U',
    'U\\' : 'L',
    'D\\' : 'R',
    'R|' : 'UD',
    'L|' : 'UD',
    'U|' : '',
    'D|' : '',
    'R-' : '',
    'L-' : '',
    'U-' : 'LR',
    'D-' : 'LR'
}

let visited, cache
let remaining = []

var AddToVisited = function(i, j)
{
    visited.add(i + ',' + j)
}

var FollowBeam = function(data, originX, originY, direction)
{
    let x = originX
    let y = originY
    while(x >= 0 && y >= 0 && x < data[0].length && y < data.length)
    {
        AddToVisited(y, x)
        let encounter = data[y][x]
        if(encounter != '.' && directionContraptionCombination[direction + encounter].length > 0) 
        {
            let result = directionContraptionCombination[direction + encounter]
            if(cache.has(x + '' + y + '' + result)) 
                return
            else
                cache.add(x + '' + y + '' + result)
            if(result.length == 1)
            {
                direction = result
            }
            else
            {
                direction = result[0]
                remaining.push([x, y, result[1]])
            }
        }

        x += directionValue[direction][1]
        y += directionValue[direction][0]
        if(x < 0 || y < 0 || x >= data[0].length || y >= data.length) 
            return
    }
}

var Display = function(data)
{
    let temp = JSON.parse(JSON.stringify(data))
    for (let i = 0; i < temp.length; i++) {
        for (let j = 0; j < temp[i].length; j++) {
            if(visited.has(i+','+j)) temp[i][j] = 'x'
            else temp[i][j] = '.'
        }
    }
    return temp.map(a => a.join(''))
}

var FindEnergizedTiles = function(data, startingX, startingY, startingDirection)
{
    FollowBeam(data, startingX, startingY, startingDirection)
    while(remaining.length > 0)
    {
        let [x, y, direction] = remaining.pop()
        FollowBeam(data, x, y, direction)
    }
    return visited.size
}

var FindBestPathForBeam = function(data)
{
    let beamInfo = []
    let edgeData = [[]]

    for(let i = 0; i < data[0].length; i++)
    {
        let startingY = 0
        beamInfo.push(FindEnergizedTiles(data, i, startingY, 'D'))
        clear()
        
        startingY = data.length - 1
        beamInfo.push(FindEnergizedTiles(data, i, startingY, 'U'))
        clear()
    }

    for(let i = 0; i < data.length; i++)
    {
        let startingX = 0
        beamInfo.push(FindEnergizedTiles(data, startingX, i, 'R'))
        clear()
        
        startingX = data[0].length - 1
        beamInfo.push(FindEnergizedTiles(data, startingX, i, 'L'))
        clear()
    }

    return Math.max(...beamInfo)
}

var formatInput = function(input, )
{
    clear()
    let data = input.split('\n').map(a => a.split(''))
    return FindBestPathForBeam(data)
    // console.log(Display(data))
}

var clear = function()
{
    visited = new Set()
    cache = new Set()
}

console.log('Dummy Output 1 : ' + formatInput(dummyInput))
// console.log('Dummy Output 2 : ' + formatInput(dummyInput2))
console.log('Actual Output : ' + formatInput(actualInput))