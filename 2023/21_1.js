/*
Learnings: 
This was an easy DFS question. Although, BFS might have been the "right" way to do this?
I felt like it would be much easier to cache this.
I was right but this might not help in the next question because I need to make changes anyway.
*/

let dummyInput = `...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`

let dummyInput2 = ``

let actualInput = `...................................................................................................................................
...........##......#..........#.#....#....................#....................#...#....#...........#................##...#......#.
....................#..........#.#.....###.............................#.......#.....#...........##.##.....#..............#..#.....
.#........#......................#...#.#..#..........#..........................###......#.#.#.#................#.............##...
.....#...........#..........#.#.#....................#.......................#.#..##.......##........#....##....#.......#..#.......
....#.#......#.....#............#............#..#...#..#...................#......#......#.............#.......#..#.....#....#.....
..#...#............#....#......#......#......#..#....#.#..........#..............#..................#..#......#...........##.#..#..
.............##...............#............#..................#....#..........#........#...............................#...#.#.....
......#......#....#....##......#.....#.........#...................................#....#................#....#......#.......##....
.....#.....#...................#....................#.......#..#....#..................#..........................#.#.......#......
...#.#..#..#................#..............#.........................##.................#..........#............#.##...........#.#.
....#........###.#..##.......#.......#..##..#...................................#.....#...##.........#..................#.......#..
..............#.............#...........#...........................#....#..........#..#...#.............#....#...........#........
.#.#.......#..#.....#..#............#...........#.........#.....#....#.........................#.............#.#...#..........#....
.......#.....#..#..#...............#...#...................##.#..........................................##.#......................
.............#........##.....#.............................#.........#..#.......................#.....#.........................#..
........#..............#......#......................#..........#..............................#...........#...........#...........
.....#.....#........#..................#....#.............#....#.........#..........................##.............................
....................#.#.....#...#........#..............#.......#.......#..#.........................#.............#.........#.....
...##.#....#.......#..........#.#........##..........#............#...#....#...#.............#...............#.............#.......
...#........#.#...................##.............#.#.......#...........#..#..................................#................#....
.........#............................................##..........#...#..#.......#..............#.....#..##...##....#..#...........
.#.....#.............#........#.......#...........#........#.#....##............................................#..............#...
.......#....##...#.....###.#....#..#............#...#.........................#.................#..#.#...........#.................
.................##....#.........#............##..#..........#.........#.....##.##............#...#.......#.......#......#.#.......
..##..............#..#..#...#.......#.......#...#..........#..........#.......##....#..........##............#.#....#....#..#......
........#...................#.#..###..............#...#.#.#.#.....#.....##..#...###..............#.......#..........#.....#........
..........##.............#......#.#....................#.#...................#..........#.............#.#....................#..##.
.#............................#..........#.#...#.........##..#...........#.#.....#...............#.........#.....#..#..............
....................#....#...##..........................#...#....#.#.......#.#...........................#...................#..#.
..........##......###....###.#............#.................................#..#...........#.......#..#.........................#..
..#.........#......###..................................#..........................##.#.#..................#.........#.##..#.#.....
.....#...................#...#...........#..#......#...................#...#...........#...#.........#...............#.............
........#.#.#.....................................#.#.........##......#.##.....#.#...#...................#.....................#...
..###..#......#.#.#.#................#.......#.#.....................#.#..#.#...............#....................#........#.##..#..
.#........#......#.##.....#...........#.............#....#...........#................................................#............
....#.........#..#................................#...............................#............................#...................
....#...#....#..#......#.........#..........#.......#.......#..........#.........#.......#.....#.............#......#...#..........
.....#..#......................................................#...#.........#................##...........#...........#..###......
...##....#...........#..........#.........#..........#..........#....##.............#....................................#......#..
....#........#.................#...........#..........#...##...................#....##...#.....#..#..............#..#..#....#......
...#.#............#.#.......................................#..#..#..................................#...............#.#.#.........
....#............#...........#...#..........#..#......................#.#...#.....#....................#.......##..........#.......
................#...................#....#....................##.........................#........................#......#.........
..............#...............#..#.......#..#......#....#...#.................#..#....#........#..#.....#.....................#....
.......#........................#.#....#....#..#................#....#.........#..............#........#...........#...............
...#.......#................#.....#........#....##.................#...#...............##.......#...#....................#.........
........#.........................#..#...##..........................##......##....#.....#.#....#..##............................#.
..#...##................##........#.........#..#.........##................................#.............#.#.................#.....
....#.............................#.............#...............#...........#...............#....#.....#....#.#....................
..........##.............#......#..................#.........#......#....#.......#....#......#....#................................
.....#.#.#........................#..#.........#.....................#..##...#.......#......#..#.....#...#..#...#..........#.......
...................#.#..........#...............#...#.#......#....#.................#.................###.....................#....
.....................................#.......#....#................#..........................#..........#.................##...#..
....#................#..#......#....#..................#..........................................#....#....#......#.......#.......
......#..........#........#...#...#..#................#.........#.........#...#.........#.#....................#..#................
.....#................#...#.#.#....#.#............##....#...........#......##..##............#......##.......#...#...............#.
...#..........#..........................#.................................#................#..........###...##.......#............
...........................#..........#......#.....#...#.#....#.....##.........##.....#.......................##..#..#..........#..
....................#......##...#.............#.....#.#....#...........#...##..#..#............#...#...............#...............
...............#.##.....#..........#..............#......#........#...........#..#.#......................#...#..#..##.............
...................#....##...#..#..............#....................###.....#............#.........##..#.....#.##..#...............
............................#......#.##.....#....#..#...#..###............#.............#.....................##...........#.......
............#.....#.#.#.........#...#........................#......#...................#...##..#.................#........#.......
................................#.........................................#...#.......#....#.........#.........#.....#...#.........
.................................................................S.................................................................
................#.......#.............................#.#......#................#..#..#......#..........#.............#............
.............##........#.......#.#............#.......#.#.......#...#.....#...........#....#..#................#...........#.......
............................#.#....##............#.##..###..............................#....#............#..#........#............
..................#........#.........##.....#....#...##.#......................###.....#..#........#.#.......##.......#............
...................#...##..........#.#..#................##....................###...................#.....#........#.#..........#.
.................##........................#....#.#..#.....##................#...........................#......#................#.
............................#........#........#..##.....#..#.......#......#.#...#...................................#...........##.
..............#..........#............#...#...............#.........#.#...#...##..##.....#...........#...#..........#.#............
.#.............#...#.........#.....###.#...............................#.....#.....#............#..#.........#.#.#.................
....#...............#..#.....#.....#.......##....#.#........#.##.............##..#.............#.#.#...........................#...
........................#.....#..#....#......#......#..#....#...#..#..........#....#...............#.........##..#.................
....#................#.....#.#............#..................#..#................#.........#.....#.............#...................
.................#.......#.....##.##.....#..................#..#......#....#...............#............#.#.#....#.........#....#..
.......#................#..#.........#......###.....#.#........#....##......#.......#..#.#.......#.#....#.#...............#........
...#.....#.#...............#....#..............#.........#...........#............#............#..#.#..##..........................
......#...............##.............#.#...............#....................#..#..##.#.#.................#......................#..
..#.....##..#.............#...#.......#.......................#........#.#.#............#...................#...................#..
........................#..#..................#..#.#.#..............................#...#...#......#....#.#........................
...#....................#................................#...#.....#...........#........#..#........#...................##.#.....#.
......#...##...#.................#..#..#....#.....#.....#.....#...#..................#.............................#..#......#.....
....................................#..................#....#...#.........#....#......................#.............#....###..#....
.##..#..#...##..........................#..#..#...........#..............#....#.........#....#....................#......##........
.##............#.#...............##....#.....#.......#..........#......#...............#..#...#........#.................#..#......
.#..#.##.........##.#..........#...........#...#...#.....#.#..#............##.........##...#.....................#...#........#....
.......#....#.#.....#........#..................#.............##........#..........##.........#..............#.#..#...#.....#.#..#.
...#..#....#........#.......................#.......#........#....#.........#..............#...#..#.#.......##...........#.#.#..#..
................#......#......................#...#...............#.#.....#......#..........#.##.#.........#....#...#......#..#....
..............##.#..#...............#.#...........#..#......#......#..#.#..#.................#.....................#.........#.#...
..#................#..#..#..........#........#.#.........#....#...........#...#.......#.#.......#......................#..#......#.
......#............#...##..........#...#..................#.....#............##............................#...#..#........#....#..
..................#..................................###.#..........#....##......#....#.................#..........#..#............
...#..#.......#......#........................#...#......#..................#.#.#.#.#.....#...................#..#...#......##...#.
....................#.#......#.......#......#....#.......#.#.......#.............#...#..#.........................#................
.........#................#.#...........##......#..#..#..................#....#......#......#.......#.#......#.........#.....#.....
..#..........#...........#.........................#.......#..........#....#...........#.#..............................#.....##...
.....#.#..#......#....#....#.............................##.....#...#......#..#..#...#..............#..........#.................#.
.............##....##.......................#.#............#................#....#.......#...................#.....................
..#.......#.........#......................................................#..#..#..............#..#.##............................
......#.......#....#............................................#.#...................##...............##......#.......#.........#.
..............#..#..............#...........#...............................#...................................#....#......#.#....
.........#....#......#.....#.................#..............#.................................................#........##..........
......#...##..............#....#.#............#..#....#...........#.........#..........................#......#.#..........##.#....
...#....#.....#........##...#...................#.#....#...........................#...........................#..........#........
.#..........#.#.....#............#.#................#...#.#..#...............#....#..........#.........#............#.......#.#....
.........#......#.#.#.......#....#...#.#......................#........#..#...#...................#.......#.........#............#.
..........................#.....#.................................#.#.....#.................................#.#...#.###....#.......
...#.................#..#.................#..............#........#.......#.#.............#................#...#..#...........#....
....#..#....................#...............................#.#....#...........................#..#.....##..#................##..#.
....#...#...#..##........##......#...#......#................#..#.......................#....#........#...#.......#..........#.....
............#.....#................#.........#.............#...#...#.#................#...........#......#..#.......#........#.#...
......#...#...........#....#..#.#..............................#......................................................#............
................#.....#.....#....#.......#..#...#..........#.#......................#..#...#.....#...........#.............#..#....
..............#.....#.......#.#.............#.................#.........##.............#......#..............#.....................
...#......#.##...............#..........#...#....#............##................#........#.#......#.#.#............................
.#....#......................#...............###.....................#..................#..#..........#...........#.....#..........
............#..#.......#....#...........#...##..#...........##....#.............#..#.#....#............#..#.......#.#.#.....#......
......#.....##.##.#.....#.#...........#.#.#...................#..................#..#..#..#........#........................#.#....
....#.........#........................#..#....##.................#............#.......#..........................##.#.....#.......
..#..#....................#..........#..........#...........................#..............#....................#..................
..............#...#...............#...........##................#..........#........#.#....#......##.......#....#.......#...##.....
......#...............#........#...#...........#.....#......................#............#.............#..........#...........##...
..#..........#.#.#........#.#..#.#..##...........#.........................#........#.#....#.#........#.........#........#......##.
..........#.#.#...#...#.#...............................#..............#....#......##..........#.#..........#...#....#.............
.....................#............#......#.#..#....#..#..#..............#....#.#........................##......#............#.....
...................................................................................................................................`

let adjacencyList = {}

let visitedGarden = new Set()

let cache = {}

var FormatInput = function(input)
{
    return input.split('\n').map(x => x.split(''))
}

var GetCoordinateText = function(i, j)
{
    return i + ',' + j
}

var isPossibleMovement = function(i, j, data)
{
    return data[i] != undefined && data[i][j] != undefined && data[i][j] != '#'
}

var FindNeighbours = function(data)
{
    for (let i = 0; i < data.length; i++) {
        for (let j = 0; j < data.length; j++) {
            
            let coordinate = GetCoordinateText(i, j)
            if(adjacencyList[coordinate] == undefined)
            {
                adjacencyList[coordinate] = []
            }
            if(data[i][j] == 'S') startingPosition = coordinate
            
            if(isPossibleMovement(i+1, j, data)) adjacencyList[coordinate].push(GetCoordinateText(i+1, j))
            if(isPossibleMovement(i-1, j, data)) adjacencyList[coordinate].push(GetCoordinateText(i-1, j))
            if(isPossibleMovement(i, j+1, data)) adjacencyList[coordinate].push(GetCoordinateText(i, j+1))
            if(isPossibleMovement(i, j-1, data)) adjacencyList[coordinate].push(GetCoordinateText(i, j-1))
        }
    }
}

var StartTravel = function(startingPosition, remainingSteps)
{
    let possibleMovements = [...adjacencyList[startingPosition]]
    let gardensReached = []     // Will help to visualize later
    if(remainingSteps == 0)
    {
        if(!visitedGarden.has(startingPosition))
        {
            gardensReached.push(startingPosition)
            visitedGarden.add(startingPosition)
        }
        return [...new Set(gardensReached)] 
    }

    while(possibleMovements.length > 0)
    {
        let nextPosition = possibleMovements.shift()
        
        let key = nextPosition + '-' + remainingSteps
        if(cache[key] != undefined)
        {
            continue
        }
        else
        {
            let newGardensReached = StartTravel(nextPosition, remainingSteps - 1)
            gardensReached.push(...newGardensReached)
            cache[key] = newGardensReached
        }
    }
    return [...new Set(gardensReached)]
}

var GetResult = function(input, steps)
{
    let data = FormatInput(input)
    FindNeighbours(data)
    let result = StartTravel(startingPosition, steps)
    return result.length
}

// console.log('Dummy Output 1 :\t' + GetResult(dummyInput, 6) + '\nExpected :\t\t16')
// console.log('Dummy Output 2 :\t' + GetResult(dummyInput2) + '\nExpected :\t\t11687500')
console.log('Actual Output : ' + GetResult(actualInput, 64))